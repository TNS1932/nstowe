<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="Nathene Stowe — finance portfolio and market tools">
  <title>Nathene Stowe — Portfolio & Market Tools</title>
  <style>
    :root{--bg:#fff;--fg:#222;--brand:#2c3e50;--accent:#3498db}
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial;line-height:1.5;color:var(--fg);background:var(--bg);padding:0;margin:0}
    a{color:var(--accent)}
    header{background:var(--brand);color:#fff;padding:1rem 0}
    .container{max-width:1100px;margin:0 auto;padding:1rem}
    nav{display:flex;align-items:center;justify-content:space-between}
    .skip-link{position:absolute;left:-999px;top:auto;background:#000;color:#fff;padding:.5rem;z-index:1000}
    .skip-link:focus{left:1rem;top:1rem}
    .logo{font-weight:700}
    main{padding:2rem 1rem}
    h1{font-size:1.75rem;margin-bottom:.25rem}
    .grid{display:grid;grid-template-columns:1fr 350px;gap:1.5rem}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #e6e9ee;padding:1rem;border-radius:8px}
    .form-row{display:flex;gap:.5rem;align-items:center}
    label{display:block;margin-bottom:.25rem;font-weight:600}
    input[type=text],input[type=file],button,select{width:100%;padding:.5rem;border:1px solid #cfd6e3;border-radius:6px}
    .results{margin-top:1rem}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .high-contrast{background:#000;color:#fff}
    footer{padding:1rem;text-align:center;font-size:.9rem;color:#666}
    .visually-important{border-left:4px solid var(--accent);padding-left:.75rem}
    [aria-live]{min-height:2.4rem}
  </style>
</head>
<body>
  <a href="#main" class="skip-link">Skip to main content</a>
  <header>
    <div class="container">
      <nav aria-label="Primary">
        <div class="logo">Nathene Stowe</div>
        <div>
          <a href="/docs" aria-label="API documentation">API Docs</a>
          &nbsp;•&nbsp;
          <button id="contrastToggle" aria-pressed="false" title="Toggle high contrast">High contrast</button>
        </div>
      </nav>
    </div>
  </header>

  <main id="main" class="container" role="main">
    <h1>Portfolio & Market Tools</h1>
    <p class="visually-important">Upload a portfolio CSV to validate it, or fetch market data for a ticker. Accessible and keyboard-friendly interface.</p>

    <div class="grid" role="region" aria-label="Tools">
      <section class="card" aria-labelledby="market-heading">
        <h2 id="market-heading">Market Lookup</h2>
        <form id="marketForm">
          <label for="symbol">Ticker (e.g. AAPL, JNJ, BTC-USD)</label>
          <div class="form-row">
            <input id="symbol" name="symbol" type="text" placeholder="AAPL" aria-describedby="symbolHelp" required>
            <button id="fetchBtn" type="submit">Fetch</button>
          </div>
          <div id="symbolHelp" class="sr-only">Enter a Yahoo Finance ticker symbol, then press Fetch.</div>
        </form>

        <div id="marketResults" class="results" aria-live="polite"></div>
      </section>

      <aside class="card" aria-labelledby="validate-heading">
        <h2 id="validate-heading">Validate Portfolio CSV</h2>
        <form id="validateForm" enctype="multipart/form-data">
          <label for="file">Select CSV file</label>
          <input id="file" name="file" type="file" accept="text/csv">
          <div style="margin-top:.5rem;display:flex;gap:.5rem">
            <button id="validateBtn" type="submit">Validate</button>
            <a href="/portfolio_example.csv" download class="button">Download example</a>
          </div>
        </form>
        <div id="validateResults" class="results" aria-live="polite"></div>
      </aside>
    </div>

    <section class="card" aria-labelledby="notes-heading" style="margin-top:1rem">
      <h2 id="notes-heading">How it works</h2>
      <p>Files are validated using the server-side <code>/validate</code> endpoint. You can also access the API docs at <a href="/docs">/docs</a> (FastAPI auto-generated).</p>
    </section>
  </main>

  <footer>
    &copy; 2026 Nathene Stowe — Accessible by design
  </footer>

  <script>
    // Contrast toggle
    const contrastBtn = document.getElementById('contrastToggle');
    contrastBtn.addEventListener('click', ()=>{
      const isHigh = document.body.classList.toggle('high-contrast');
      contrastBtn.setAttribute('aria-pressed', String(isHigh));
    });

    // Market fetch
    document.getElementById('marketForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const s = document.getElementById('symbol').value.trim();
      const resEl = document.getElementById('marketResults');
      resEl.textContent = 'Loading...';
      try{
        const r = await fetch('/api/market/' + encodeURIComponent(s));
        if(!r.ok) throw r;
        const data = await r.json();
        if(Array.isArray(data) && data.length>0){
          const sample = data.slice(-1)[0];
          resEl.innerHTML = `<strong>Latest:</strong> ${sample.Close} (${sample.Date || sample.date || ''})`;
        }else{
          resEl.textContent = 'No market data available for ' + s;
        }
      }catch(err){
        resEl.textContent = 'Error fetching market data';
      }
    });

    // Validate upload
    document.getElementById('validateForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fileInput = document.getElementById('file');
      const resEl = document.getElementById('validateResults');
      if(!fileInput.files.length){ resEl.textContent = 'Please select a file.'; return; }
      resEl.textContent = 'Validating...';
      const fd = new FormData();
      fd.append('file', fileInput.files[0]);
      try{
        const r = await fetch('/api/validate',{method:'POST', body: fd});
        const json = await r.json();
        if(r.ok){
          resEl.innerHTML = `<div><strong>Original rows:</strong> ${json.original_rows}</div><div><strong>Sanitized rows:</strong> ${json.sanitized_rows}</div>`;
          if(json.issues && json.issues.length){
            const ul = document.createElement('ul');
            json.issues.forEach(i=>{ const li = document.createElement('li'); li.textContent = `Row ${i.row_index}: ${i.issues.join(', ')}`; ul.appendChild(li); });
            resEl.appendChild(ul);
          }else{
            resEl.appendChild(document.createTextNode('No issues found.'));
          }
        }else{
          resEl.textContent = json.detail || 'Validation failed';
        }
      }catch(err){ resEl.textContent = 'Error validating file'; }
    });
  </script>
</body>
</html>